{% extends 'base.html.twig' %}

{% block title %}Page Profil{% endblock %}

{% block body %}

<div class="col-12 ">
    <p><a href="{{path('home')}}" class="btn btn-dark ml-5 mt-2"><i class="fas fa-arrow-circle-left"></i> Retour</a></p>
    
    <div class="row col-12 col-md-11 mx-auto p-lg-0 d-flex justify-content-between">

    {# Messages flash #}
    {% for message in app.flashes('notice') %}
        <div class="alert alert-success flash-message mb-2">
            {{ message }}
        </div>
    {% endfor %}
    {% for message in app.flashes('danger') %}
        <div class="alert alert-danger flash-message mb-2">
            {{ message }}
        </div>
    {% endfor %}   
    {% for message in app.flashes('warning') %}
        <div class="alert alert-danger flash-message mb-2">
            {{ message }}
        </div>
    {% endfor %}   

        <div class="col-12 col-md-10 mx-auto">

            {# Carte de visite #}
            <div class="card">
                <div class="card d-flex flex-row flex-wrap justify-content-around">

                    {# image profil & bouton modif #}
                    <div class="d-flex flex-column">
                        <div class="p-2">
                            <img src="{{ asset('uploads/images/'~ (candidateDatas.picture ?:'default-candidate.png')) }}"
                                style="width: 100px;height:100px;" class="mb-2 rounded-circle" />
                        </div>

                        <div class="p-2">
                            <p class ="text-center">
                                <a href= "{{ path("picture_edit", {"id": candidateDatas.id }) }}">
                                    <button class="btn btn-light btn-sm" id="" type="button"> <i class="fas fa-edit"></i></button>
                                </a>
                            </p>
                        </div>
                    </div>

                    {# nom/prénom/mail/tel/ & bouton modif #}   
                    <div class="d-flex flex-column ">
                        <div class="p-2 table-responsive">
                            <table class="table">
                                
                                {# titre de colonne Infos persos #}
                                <thead>       
                                    <th scope="col" class="font-weight-bold h5">
                                    Informations Personnelles
                                        <a href= "{{ path("candidate_informations", {"id": app.user.id }) }}">
                                            <button class="btn btn-light btn-sm" id="" type="button"> <i class="fas fa-edit"></i></button>
                                        </a>
                                    </th>
                                </thead>

                                {# Contenu colonne Infos persos #}
                                <tbody>
                                    <tr>
                                        <th>{{ app.user.lastname }} {{ app.user.firstname }}</th>
                                    </tr>
                                    <tr>
                                        <td>{{ app.user.email }}</td>
                                    </tr>
                                </tbody>
                            </table>

                            <table class="table">

                                {# titre de colonne Carte de visite #}
                                <thead>
                                    <tr>          
                                        <th scope="col" class="font-weight-bold h5">
                                        Carte de visite
                                            <a href= "{{ path("presentation_edit", {"id": candidateDatas.id }) }}">
                                                <button class="btn btn-light btn-sm" id="" type="button"> <i class="fas fa-edit"></i></button>
                                            </a>
                                        </th>
                                    </tr>
                                </thead>
                                
                                {# Contenu colonne carte de visite #}
                                <tbody>                              
                                    <tr>
                                        <td>
                                            <span class="font-weight-bold">Visible par les recruteurs :</span>
                                                {% if candidateInformation.visibilityChoice == 0 %}
                                                    nom et prénom
                                                {% elseif candidateInformation.visibilityChoice == 2 %}
                                                    prénom uniquement
                                                {% else %}
                                                    nom uniquement
                                                {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <span class="font-weight-bold">Téléphone :</span>
                                            {{ candidateDatas.phoneNumber }}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>                         
                        </div>
                    </div>
                        
                    {# Statut, mobilities & boutons #}
                    <div class="d-flex flex-column"> 
                        <div class="p-2 table-responsive">
                            <table class="table">
                                <tbody>
                                    {% for webSite in webSites %}
                                    <tr>
                                        <td>  <a href="{{webSite.link}}">{{webSite.name}}</a>
                                            <a href= "{{ path("website_edit", {"id": webSite.id }) }}">
                                                <button class="btn btn-light btn-sm" id="" type="button"> <i class="fas fa-edit"></i></button>
                                            </a>
                                            <a href= "{{ path("website_delete", {"id": webSite.id }) }}">
                                                <button class="btn btn-light btn-sm" id="" type="button"><i class="far fa-trash-alt delete-button"></i></i></button>
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    <tr>
                                        <td
                                            <a href="{{ path("website_add") }}"><button type="button" class="btn btn-outline-success btn-sm">Ajouter un site <i class="fas fa-plus-circle"></i></button></a>
                                        </td> 
                                    </tr>
                                    <tr>
                                        {% if candidateInformation.adopted == 1 %}
                                            <th> <span class="badge badge-pill badge-success">Adopté !</span>
                                        {% else %}
                                            <th> <span class="badge badge-pill badge-warning">En recherche d'alternance</span>
                                        {% endif %}
                                            </th>
                                            <td>                                   
                                                <a href= "{{ path("adopted_edit", {"id": visitCardId }) }}">
                                                    <button class="btn btn-light btn-sm" id="" type="button"> <i class="fas fa-edit"></i></button>
                                                </a>
                                            </td>
                                    </tr>

                                    {# Si le candidat est adopté, on n'affiche plus ses lieux de recherche #}
                                    {% if candidateInformation.adopted == 1 %}

                                    {# Si le candidat n'est pas adopté, on affiche ses lieux de recherche #}
                                    {% else %}
                                    <tr>
                                        <th class="text-secondary">Lieux de recherche :
                                        </th>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td >
                                            {% for mobilityInfo in mobilitiesInfo %}
                                                <p>{{mobilityInfo.townName}}, {{mobilityInfo.department.name}} </p>
                                            {% endfor %}
                                        </td> 
                                                                                        
                                        <td >
                                            {% for mobilityInfo in mobilitiesInfo %}
                                                <p class ="mb-1">
                                                    <a href= "{{ path("mobility_edit", {"id": mobilityInfo.id }) }}">
                                                        <button class="btn btn-light btn-sm " id="" type="button"> <i class="fas fa-edit"></i></button>
                                                    </a>
                                                    <a href= "{{ path("mobility_delete", {"id": mobilityInfo.id }) }}"><button class="btn btn-light btn-sm" id="" type="button"><i class="far fa-trash-alt delete-button"></i></i></button>
                                                    </a>
                                                </p>
                                            {% endfor %}
                                        </td>                                                       
                                    </tr>
                                    <tr>
                                        <td>
                                            <a href="{{ path("mobility_add")}}"><button type="button" class="btn btn-outline-success btn-sm">Ajouter un lieu <i class="fas fa-plus-circle"></i></button></a>
                                        </td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>                             
                        </div>                     
                    </div> {# fin site web, statut recherche ou adopté &mobilities & boutons modif #}
            </div> {# Fin carte visite #}

            {# Accordéon Ils ont vu votre profil #}
            <div class="card accordion col-12 col-lg-12 p-0 " id="accordionExample">
                <div class="card-header col-12 h5 mb-0 text-white text-center profil" id="headingOne" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                Ils ont vu votre profil !
                </div>

                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                    <div class="card-body d-md-flex flex-row flex-wrap justify-content-around">
                        {% for viewInfo in viewsInfo %}
                            <h3><span class="badge badge-pill badge-info">{{ viewInfo.companyName}}</span></h3>                         
                        {% endfor %}
                    </div>
                </div>
            </div>

            {# A propos de moi #}
            <div class="card">
                <div class="card-header">
                        <h2 class="h5 mb-0 text-center text-secondary">
                            À propos de moi
                            <a href= "{{ path("about_edit", {"id": visitCardId }) }}">
                                <button class="btn btn-light btn-sm " id="" type="button"> <i class="fas fa-edit"></i></button>
                            </a>
                        </h2>
                </div>
                <div class="card-body">
                    <p class="text-justify">
                        {{ candidateInformation.about}}
                    </p>
                </div>

            </div>

            {# Alternance recherchée #}
            <div class="card">
                <div class="card-header">
                    <h2 class="h5 mb-0 text-center text-secondary">
                        Alternance recherchée
                    </h2>
                </div>                      
                    <div class="card-body">
                        <div class="table-responsive">
                                <table class="table">
                                <thead>{# titre de colonnes #}
                                    <tr class ="d-flex justify-content-center">
                                        <th scope="col" class="text-info d-flex col-4">
                                        Ajouter une alternance
                                        </th>
                                        <th scope="col" class="text-info d-flex col-7">
                                            <a href= "{{ path("apprenticeship_add") }}">
                                                <button class="btn btn-light " id="" type="button"> <i class="fas fa-plus"></i></button>
                                            </a>                    
                                        </th>                           
                                    </tr>
                                </thead>{# fin titre de colonnes #}
                            </table>
                        </div>
                    </div>
                    {% for formationInfo in formationsInfo %}  {# Carte Alternace recherchée n'apparait que s'il y a une formation avec le statut 2 Pas de bouton add car 1 seul alternance possible à la fois#}                                    
                        {% if formationInfo.status == 2 %}
                    
                            <div class="card-body">
                                <div class="table-responsive">
                                        <table class="table">
                                        <thead>{# titre de colonnes #}
                                            <tr class ="d-flex justify-content-center">
                                            <th scope="col" class="text-info d-flex col-4">
                                            Modifier mes informations
                                            </th>
                                            <th scope="col" class="text-info d-flex col-7">
                                                <a href= "{{ path("apprenticeship_edit", {"id": formationInfo.id }) }}">
                                                    <button class="btn btn-light " id="" type="button"> <i class="fas fa-edit"></i></button>
                                                </a>
                                                <a href= "{{ path("apprenticeship_delete", {"id": formationInfo.id }) }}">
                                                    <button class="btn btn-light " id="" type="button"> <i class="fas fa-window-close"></i></button>
                                                </a>
                                                
                                            </th>                           
                                            </tr>
                                        </thead>{# fin titre de colonnes #}
                                        <tbody>
                                        <tr class ="d-flex justify-content-center">
                                        <th scope="row" class ="d-flex col-4">A partir du </th> 
                                        <td class ="d-flex col-7">{{ formationInfo.startedAt|date("m/d/Y")}}</td>                                                      
                                        </tr>
                                        <tr class ="d-flex justify-content-center">
                                        <th scope="row" class ="d-flex col-4">Jusqu'au </th> 
                                        <td class ="d-flex col-7">{{ formationInfo.endedAt|date("m/d/Y")}}</td>
                                        </tr>
                                        <tr class ="d-flex justify-content-center">
                                        <th scope="row" class ="d-flex col-4">Avec l'école</th> 
                                        <td class ="d-flex col-7">{{ formationInfo.school.name}}</td>
                                        </tr>
                                        <tr class ="d-flex justify-content-center">
                                            <th scope="row" class ="d-flex col-4">Pour obtenir le diplôme</th> 
                                            <td class ="d-flex col-7">{{ formationInfo.awardName}}</td>
                                        </tr>
                                        <tr class ="d-flex justify-content-center">
                                            <th scope="row" class ="d-flex col-4">De niveau</th> 
                                            <td class ="d-flex col-7">{{ formationInfo.awardLevel.name}}</td>
                                        </tr>                                           
                                        </tbody>
                                    </table>
                                </div>
                            </div>             
                        {% endif %}
                    {% endfor %}{# FIN Carte Alternace recherchée n'apparait que s'il y a une formation avec le statut 2#}
            </div> {# Fin carte Alternance recherchée #}

            

            <div class="card"> {# Carte expériences si pas d'exp seul l'ajout d'exp possible#}
                    <div class="card-header">
                        <h2 class="h5 mb-0 text-center text-secondary">
                            Expériences
                        </h2>
                    </div>
                        <div class="card-body">

                            <div class="table-responsive">
                                <table class="table">
                                    <thead>{# titre de colonnes #}
                                        <tr class ="d-flex justify-content-center">
                                            <th scope="col" class="text-info d-flex col-3">
                                            Ajouter une expérience
                                            </th>
                                            <th scope="col" class="text-info d-flex col-3">
                                                <a href= "{{ path("experience_add") }}">
                                                    <button class="btn btn-light " id="" type="button"> <i class="fas fa-plus"></i></button>
                                                </a>
                                            </th>
                                            <th scope="col" class="d-flex col-4"></th>
                                                <th scope="col" class="d-flex col-1"></th>
                                                
                                        </tr>
                                    </thead>{# fin titre de colonnes #}
                                </table>
                            </div>

                            {% for experienceInfo in experiencesInfo %}
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>{# titre de colonnes #}
                                            <tr class ="d-flex justify-content-center ">
                                                <th scope="col" class="d-flex col-3 ">Période</th>
                                                <th scope="col" class="d-flex col-3 ">Entreprise</th>
                                                <th scope="col" class="d-flex col-4 ">Description</th>
                                                <th scope="col" class="d-flex col-1 "></th>
                                            </tr>
                                        </thead>{# fin titre de colonnes #}
                                        <tbody>{# corps tableau exp #}
                                            <tr class ="d-flex justify-content-center">
                                                <td class="d-flex col-3 ">
                                                Du {{ experienceInfo.startedAt|date("m/d/Y")}}
                                                {% if experienceInfo.endedAt == null %}
                                                à aujourd'hui

                                                {% else %}
                                                au {{ experienceInfo.endedAt|date("m/d/Y")}}
                                                {% endif %}

                                                </td>
                                                <td class="d-flex col-3">{{ experienceInfo.companyName}}</td>
                                                <td class="d-flex col-4">{{ experienceInfo.description}}</td>

                                                <td class="d-flex col-1">
                                                    <a href= "{{ path("experience_edit", {"id": experienceInfo.id }) }}">
                                                        <button class="btn btn-light " id="" type="button"> <i class="fas fa-edit"></i></button>
                                                    </a>
                                                    <a href= "{{ path("experience_delete", {"id": experienceInfo.id }) }}">
                                                        <button class="btn btn-light " id="" type="button"> <i class="fas fa-window-close"></i></button>
                                                    </a>
                                                </td>
                                            </tr>                                              
                                        </tbody>{# fin corps tableau exp #}
                                    </table>
                                </div>
                            {% endfor %}
                        </div>

            </div> {# Fin carte exp #}

            <div class="card"> {# Carte formation Si pas de formation trouvée se trouve juste le boutons ajouter une formation#}
                    <div class="card-header">
                        <h2 class="h5 mb-0 text-center text-secondary">
                            Formations
                        </h2>
                    </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>{# titre de colonnes #}
                                        <tr class ="d-flex justify-content-center">
                                            <th scope="col" class="text-info d-flex col-4">
                                            Ajouter une formation
                                            </th>
                                            <th scope="col" class="text-info d-flex col-7">
                                                <a href= "{{ path("formation_add") }}">
                                                    <button class="btn btn-light " id="" type="button"> <i class="fas fa-plus"></i></button>
                                                </a>
                                            </th>                           
                                        </tr>
                                    </thead>{# fin titre de colonnes #}
                                </table>
                            </div>
                        {% for formationInfo in formationsInfo %}
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>{# titre de colonnes #}
                                        <tr class ="d-flex justify-content-center">
                                            <th scope="col" class="text-info col-4">
                                            {{ formationInfo.awardName}}</th>
                                            <th class="text-info col-7">
                                                <a href= "{{ path("formation_edit", {"id": formationInfo.id }) }}">
                                                    <button class="btn btn-light " id="" type="button"> <i class="fas fa-edit"></i></button>
                                                </a>
                                                <a href= "{{ path("formation_delete", {"id": formationInfo.id }) }}">
                                                    <button class="btn btn-light " id="" type="button"> <i class="fas fa-window-close"></i></button>
                                                </a>
                                            </th>
                                            
                                                
                                        </tr>
                                    </thead>{# fin titre de colonnes #}
                                    <tbody>
                                        <tr class ="d-flex justify-content-center">{#Niveau du diplôme#}
                                            <th scope="row" class ="d-flex col-4">Niveau scolaire
                                            </th>                                                    
                                            <td class ="d-flex col-7">{{ formationInfo.awardLevel.name}}
                                            </td>                                                       
                                        </tr>
                                        <tr class ="d-flex justify-content-center"> {#Nom de l'école#}
                                            <th scope="row" class ="d-flex col-4">Ecole
                                            </th>                                         
                                            <td class ="d-flex col-7">{{ formationInfo.school.name}}
                                            </td>                                                                         
                                        </tr>
                                        <tr class ="d-flex justify-content-center">{#Date obtention diplôme OU formation toujours en cours#}
                                            <th scope="row" class ="d-flex col-4">Date d'obtention du diplôme
                                            </th>
                                                                                    
                                            {% if formationInfo.status == 0 %}
                                            <td class ="d-flex col-7">{{ formationInfo.obtainedAt|date("m/d/Y")}}</td>
                                            {% elseif formationInfo.status == 1 %}
                                            <td class ="d-flex col-7">en cours</td>
                                            {% elseif formationInfo.status == 2 %}
                                            <td class ="d-flex col-7">en cours et en recherche d'alternance</td>
                                            {% endif %}
                                        </tr>
                                    </tbody>
                                </table>
                            
                            </div>
                        {% endfor %}
                        </div>

                </div> {# Fin carte formation #}

            <div class="card"> {# Carte compétences si pas de compétence seulement la possibilité d'ajouter #}
                    <div class="card-header">
                        <h2 class="h5 mb-0 text-center text-secondary">
                            Compétences
                        </h2>
                    </div>

                    <div class="card-body">
                        <div class="table-responsive">
                                <table class="table">
                                    <thead>{# titre de colonnes #}
                                        <tr class = "d-flex justify-content-center">
                                            <th scope="col" class="text-info d-flex col-6">
                                            Ajouter une compétence
                                            </th>
                                            <th class = "d-flex col-5">
                                                {# <a href= "{{ path("skill_add") }}"> #}
                                                    <button class="btn btn-light " id="" type="button"> <i class="fas fa-plus"></i></button>
                                                </a>
                                            </th>
                                                                                        
                                        </tr>
                                    </thead>{# fin titre de colonnes #}
                                </table>
                            </div>
                        {# {{ dump(candidateInformation.skills)}} #}
                            
                            {% for skill in candidateInformation.skills %}
                                <p> {{ skill.name }}</p>
                            {% endfor %}
    
                            <div class="table-responsive">
                                <table class="table ">                           
                                    <tr class = "d-flex justify-content-center">
                                        <td class = "d-flex col-6">
                                        {# {{skillInfo.name}} #}
                                        </td>
                                        {# <td class = "d-flex col-5">
                                            <a href= "{{ path("skill_edit", {"id": skillInfo.id }) }}">
                                                <button class="btn btn-light " id="" type="button"> <i class="fas fa-edit"></i></button>
                                            </a>
                                            <a href= "{{ path("skill_delete", {"id": skillInfo.id }) }}">
                                                <button class="btn btn-light " id="" type="button"> <i class="fas fa-window-close"></i></button>
                                            </a> #}
                                        </td>
                                    </tr>                           
                                </table>
                            </div>

                    </div>                        

            </div> {# Fin carte compétences #}

            <div class="card"> {# carte Atouts et centres d'intérêts si pas de donnée seulement la possibilité d'ajouter#}
                    <div class="card-header">
                        <h2 class="h5 mb-0 text-center text-secondary">
                            Atouts et centres d'intérêts
                        </h2>
                    </div>
                    <div class="card-body">

                        <div class="table-responsive">
                            <table class="table">
                                <thead>{# titre de colonnes #}
                                    <tr class = "d-flex justify-content-center">
                                        <th scope="col" class="text-info d-flex col-6">
                                        Ajouter un atout ou un centre d'intérêt
                                        </th>
                                        <th scope="col" class="d-flex col-5">
                                            <a href= "{{ path("asset_add") }}">
                                                <button class="btn btn-light " id="" type="button"> <i class="fas fa-plus"></i></button>
                                            </a>
                                        </th>
                                    </tr>
                                </thead>{# fin titre de colonnes #}
                            </table>
                        </div>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>{# titre de colonnes #}
                                    <tr class = "d-flex justify-content-center">
                                        <th class = "d-flex col-6" scope="col">Atouts</th>
                                        <th class = "d-flex col-5"></th>
                                    </tr>
                                </thead>{# fin titre de colonnes #}
                            </table>
                        </div>                                 
                                            
                        {% for additionalInfo in additionalsInfo %}
                            {% if additionalInfo.typeInfo == 'assert' %}
                                <div class="table-responsive">
                                    <table class="table">
                                        <tbody>
                                            <tr class = "d-flex justify-content-center">
                                                <td class = "d-flex col-6">
                                                {{additionalInfo.content}}
                                                </td>
                                                <td class = "d-flex col-5">
                                                    <a href= "{{ path("asset_edit", {"id": additionalInfo.id }) }}">
                                                        <button class="btn btn-light " id="" type="button"> <i class="fas fa-edit"></i></button>
                                                    </a>
                                                    <a href= "{{ path("asset_delete", {"id": additionalInfo.id }) }}">
                                                        <button class="btn btn-light " id="" type="button"> <i class="fas fa-window-close"></i></button>
                                                    </a>
                                                </td>                                            
                                            </tbody> 
                                    </table>
                                </div>    
                            
                            {% endif %}                                                                            
                        {% endfor %}

                        <div class="table-responsive">
                            <table class="table">
                                <thead>{# titre de colonnes #}
                                    <tr class = "d-flex justify-content-center">
                                        <th class = "d-flex col-6" scope="col">Centres d'intérêts</th>
                                        <th class = "d-flex col-5"></th>
                                    </tr>
                                </thead>{# fin titre de colonnes #}
                            </table>
                        </div>    

                        {% for additionalInfo in additionalsInfo %}
                            {% if additionalInfo.typeInfo == 'interest' %}
                                <div class="table-responsive">
                                    <table class="table">
                                        <tbody>{# corps tableau centres d'intérêts#}                                  
                                            <tr class = "d-flex justify-content-center">
                                                <td class = "d-flex col-6">
                                                {{additionalInfo.content}}
                                                </td>
                                                <td class = "d-flex col-5">
                                                    <a href= "{{ path("asset_edit", {"id": additionalInfo.id }) }}">
                                                        <button class="btn btn-light " id="" type="button"> <i class="fas fa-edit"></i></button>
                                                    </a>
                                                    <a href= "{{ path("asset_delete", {"id": additionalInfo.id }) }}">
                                                        <button class="btn btn-light " id="" type="button"> <i class="fas fa-window-close"></i></button>
                                                    </a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>                                              
                            {% else %}
                            {% endif %}                                     
                        {% endfor %}
                            
                    </div>            

            </div> {# Fin carte Savoirs-faire et centres d'intérêts #}

            


            {# Lien retour #}
            <p>

            </p>
        </div>


    </div>

    </div>
<p><a href="{{path('home')}}" class="btn btn-dark ml-5 mt-2"><i class="fas fa-arrow-circle-left"></i> Retour</a></p>
</div>


    {% endblock %}